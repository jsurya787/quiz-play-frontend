@if (visible()) {
  <div
    class="fixed inset-0 z-50
           bg-black/50 backdrop-blur-sm
           flex items-center justify-center px-4">

    <!-- MODAL -->
    <div
      class="relative w-full max-w-md
             rounded-3xl
             bg-white/80 backdrop-blur-xl
             shadow-[0_30px_80px_rgba(0,0,0,0.25)]
             border border-black/5
             p-6 animate-fade-in">

      <!-- HEADER -->
      <h3 class="text-xl font-extrabold text-gray-900 mb-6 text-center">
        {{ isEdit() ? 'Update Subject' : 'Add New Subject' }}
      </h3>

      <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-4">

        <!-- NAME -->
        <div>
          <input
            class="w-full rounded-xl border border-black/10
                   px-4 py-2.5 text-sm
                   focus:outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="Subject name"
            formControlName="name" />

          @if (showErrors() && form.controls.name.invalid) {
            <p class="text-xs text-red-500 mt-1">
              Subject name is required
            </p>
          }
        </div>

        <!-- CLASS -->
        <div>
          <input
            class="w-full rounded-xl border border-black/10
                   px-4 py-2.5 text-sm
                   focus:outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="Class (eg: 10, 11, 12)"
            formControlName="subjectClass" />

          @if (showErrors() && form.controls.subjectClass.invalid) {
            <p class="text-xs text-red-500 mt-1">
              Class is required
            </p>
          }
        </div>

        <!-- DESCRIPTION -->
        <div>
          <textarea
            rows="3"
            class="w-full rounded-xl border border-black/10
                   px-4 py-2.5 text-sm
                   focus:outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="Short description"
            formControlName="description"></textarea>

          @if (showErrors() && form.controls.description.invalid) {
            <p class="text-xs text-red-500 mt-1">
              Description is required
            </p>
          }
        </div>

        <!-- LOGO UPLOAD (CINEMATIC) -->
        <div>
          <label class="block text-sm font-semibold mb-2">
            Subject Logo
          </label>

          <div
            class="relative rounded-2xl border-2 border-dashed
                   border-indigo-300/60
                   bg-indigo-50/50
                   p-4 text-center
                   hover:bg-indigo-50 transition">

            @if (logoPreview()) {
              <img
                [src]="logoPreview()"
                class="mx-auto h-20 w-20 rounded-xl
                       object-contain bg-white
                       shadow-sm mb-2" />
            } @else {
              <div class="text-sm text-gray-500">
                Click to upload logo
              </div>
            }

            <input
              type="file"
              accept="image/*"
              class="absolute inset-0 opacity-0 cursor-pointer"
              (change)="onLogoSelect($event)" />
          </div>

          @if (showErrors() && !logoFile() && !isEdit()) {
            <p class="text-xs text-red-500 mt-1">
              Subject logo is required
            </p>
          }
        </div>

        <!-- KEY POINTS -->
        <div>
          <label class="block text-sm font-semibold mb-2">
            Key Points
          </label>

          <div class="flex gap-2 mb-2">
            <input
              class="flex-1 rounded-xl border border-black/10
                     px-4 py-2 text-sm
                     focus:outline-none focus:ring-2 focus:ring-indigo-500"
              [(ngModel)]="keyPoint"
              [ngModelOptions]="{ standalone: true }"
              placeholder="Add key point"
              (keydown.enter)="$event.preventDefault(); addKeyPoint()" />

            <button
              type="button"
              class="px-4 py-2 rounded-xl
                     bg-indigo-600 text-white text-sm font-semibold
                     hover:bg-indigo-700 active:scale-95 transition"
              (click)="addKeyPoint()">
              Add
            </button>
          </div>

          <div class="flex flex-wrap gap-2">
            @for (k of keyPoints; track $index) {
              <span
                class="flex items-center gap-1
                       px-3 py-1 rounded-full
                       bg-indigo-100 text-indigo-700 text-xs">
                {{ k }}
                <button
                  type="button"
                  class="text-indigo-500 hover:text-red-500"
                  (click)="removeKeyPoint($index)">âœ•</button>
              </span>
            }
          </div>

          @if (showErrors() && !hasMinKeyPoints) {
            <p class="text-xs text-red-500 mt-1">
              Please add at least 4 key points
            </p>
          }
        </div>

        <!-- ACTIVE -->
        <label class="flex items-center gap-2 text-sm">
          <input type="checkbox" formControlName="isActive" />
          Active
        </label>

        <!-- ACTIONS -->
        <div class="flex justify-end gap-3 pt-4">
          <button
            type="button"
            class="px-4 py-2 rounded-xl text-sm
                   border border-black/10
                   hover:bg-gray-50"
            (click)="close()">
            Cancel
          </button>

          <button
            type="submit"
            class="px-5 py-2.5 rounded-xl
                   bg-indigo-600 text-white
                   text-sm font-semibold
                   hover:bg-indigo-700 active:scale-95 transition">
            {{ isEdit() ? 'Update' : 'Create' }}
          </button>
        </div>

      </form>
    </div>
  </div>
}
