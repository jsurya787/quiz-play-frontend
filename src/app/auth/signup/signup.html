<!-- ================= SIGNUP FLOW ================= -->
<section class="relative min-h-screen flex items-center justify-center overflow-hidden bg-gray-50">

  <!-- Background Decor -->
  <div class="absolute inset-0 z-0">
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[600px] bg-indigo-200/20 rounded-full blur-[100px] animate-pulse"></div>
    <div class="absolute bottom-0 right-0 w-[800px] h-[800px] bg-purple-200/20 rounded-full blur-[100px]"></div>
  </div>

  <div class="w-full max-w-md relative z-10 px-6 py-12">

    <!-- ================= SIGNUP FORM ================= -->
    @if (step() == 'form') {
      <div class="bg-white/70 backdrop-blur-xl rounded-3xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-white/40 p-8 md:p-10 animate-fade-scale-in">
        
        <!-- Header -->
        <div class="text-center mb-8">
          <div class="inline-flex items-center justify-center w-12 h-12 rounded-xl bg-indigo-600 text-white text-2xl mb-4 shadow-lg shadow-indigo-500/30">
            ‚ú®
          </div>
          <h2 class="text-2xl font-bold text-gray-900">Create Your Account</h2>
          <p class="text-gray-500 mt-2">Join thousands of learners today</p>
        </div>

        <!-- Form -->
        <div class="space-y-4">
          
          <!-- Name Row -->
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1.5 ml-1">First Name</label>
              <input
                type="text"
                class="input-ios"
                [class.border-red-500]="submitted && !firstName"
                placeholder="John"
                [(ngModel)]="firstName" />
              @if (submitted && !firstName) {
                <p class="text-red-500 text-xs mt-1 ml-1">Required</p>
              }
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1.5 ml-1">Last Name</label>
              <input
                type="text"
                class="input-ios"
                [class.border-red-500]="submitted && !lastName"
                placeholder="Doe"
                [(ngModel)]="lastName" />
              @if (submitted && !lastName) {
                <p class="text-red-500 text-xs mt-1 ml-1">Required</p>
              }
            </div>
          </div>

          <!-- Email -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1.5 ml-1">Email</label>
            <input
              type="email"
              class="input-ios"
              [class.border-red-500]="submitted && !email"
              placeholder="john@example.com"
              [(ngModel)]="email" />
            @if (submitted && !email) {
              <p class="text-red-500 text-xs mt-1 ml-1">Email is required</p>
            }
          </div>

          <!-- Password -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1.5 ml-1">Password</label>
            <input
              type="password"
              class="input-ios"
              [class.border-red-500]="submitted && !password"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              [(ngModel)]="password" />
            @if (submitted && !password) {
              <p class="text-red-500 text-xs mt-1 ml-1">Password is required</p>
            }
          </div>

          <!-- Confirm Password -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1.5 ml-1">Confirm Password</label>
            <input
              type="password"
              class="input-ios"
              [class.border-red-500]="submitted && password !== confirmPassword"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              [(ngModel)]="confirmPassword" />
            @if (submitted && password && password !== confirmPassword) {
              <p class="text-red-500 text-xs mt-1 ml-1">Passwords do not match</p>
            }
          </div>

          <!-- API Error -->
          @if (error()) {
            <div class="p-3 rounded-xl bg-red-50 border border-red-100 text-red-600 text-sm text-center">
              {{ error() }}
            </div>
          }

          <!-- Submit Button -->
          <button
            class="w-full mt-2 px-6 py-3.5 rounded-xl
                   bg-indigo-600 text-white font-semibold
                   shadow-lg shadow-indigo-500/30
                   hover:bg-indigo-700 hover:shadow-xl
                   transition-all duration-200
                   active:scale-95
                   flex items-center justify-center gap-2"
  
            (click)="signup()">
            @if (loading) {
              <span class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
              Creating account...
            } @else {
              Create Account
            }
          </button>

        </div>

        <!-- Divider -->
        <div class="relative my-6">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-gray-200"></div>
          </div>
          <div class="relative flex justify-center text-sm">
            <span class="px-2 bg-white/50 text-gray-500 backdrop-blur-xl">Or continue with</span>
          </div>
        </div>

        <!-- Google Button -->
        <button
          class="w-full flex items-center justify-center gap-3 px-4 py-3 border border-gray-200 rounded-2xl bg-white hover:bg-gray-50 hover:border-gray-300 transition-all duration-200"
          (click)="signupWithGoogle()">
          <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt="Google" />
          <span class="font-semibold text-gray-700">Google</span>
        </button>

        <!-- Login Link -->
        <p class="text-center text-sm mt-6 text-gray-600">
          Already have an account?
          <a routerLink="/login" class="font-bold text-indigo-600 hover:text-indigo-700 hover:underline">
            Sign in
          </a>
        </p>

      </div>
    }

    <!-- ================= OTP VERIFICATION ================= -->
    @if (step() == 'otp') {
      <div class="bg-white/70 backdrop-blur-xl rounded-3xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-white/40 p-8 md:p-10 animate-fade-scale-in">
        
        <!-- Header -->
        <div class="text-center mb-8">
          <div class="inline-flex items-center justify-center w-14 h-14 rounded-2xl bg-indigo-100 text-indigo-600 text-3xl mb-4">
            üìß
          </div>
          <h2 class="text-2xl font-bold text-gray-900">Verify Your Email</h2>
          <p class="text-gray-500 mt-2">
            We've sent a 6-digit code to<br>
            <span class="font-semibold text-gray-700">{{ email }}</span>
          </p>
        </div>

        <!-- OTP Input -->
        <div class="flex justify-center gap-2 mb-6">
          @for (i of [0,1,2,3,4,5]; track i) {
            <input
              type="text"
              maxlength="1"
              class="otp-input"
              [class.border-red-500]="otpError()"
              [(ngModel)]="otpDigits[i]"
              (input)="onOtpInput($event, i)"
              (keydown)="onOtpKeydown($event, i)"
              (paste)="onOtpPaste($event)"
              #otpInputs />
          }
        </div>

        <!-- OTP Error -->
        @if (otpError()) {
          <div class="p-3 rounded-xl bg-red-50 border border-red-100 text-red-600 text-sm text-center mb-4">
            {{ otpError() }}
          </div>
        }

        <!-- Verify Button -->
        <button
          class="w-full px-6 py-3.5 rounded-xl
                 bg-indigo-600 text-white font-semibold
                 shadow-lg shadow-indigo-500/30
                 hover:bg-indigo-700 hover:shadow-xl
                 transition-all duration-200
                 active:scale-95
                 flex items-center justify-center gap-2"
          [disabled]="verifying"
          (click)="verifyOtp()">
          @if (verifying) {
            <span class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
            Verifying...
          } @else {
            Verify Email
          }
        </button>

        <!-- Resend OTP -->
        <div class="text-center mt-6">
          <p class="text-sm text-gray-500">
            Didn't receive the code?
            @if (resendCooldown > 0) {
              <span class="text-gray-400">Resend in {{ resendCooldown }}s</span>
            } @else {
              <button
                class="font-semibold text-indigo-600 hover:text-indigo-700"
                [disabled]="resending"
                (click)="resendOtp()">
                @if (resending) {
                  Sending...
                } @else {
                  Resend code
                }
              </button>
            }
          </p>
        </div>

        <!-- Back Button -->
        <button
          class="w-full mt-4 text-sm text-gray-500 hover:text-gray-700 transition"
          (click)="step.set('form')">
          ‚Üê Back to signup
        </button>

      </div>
    }

  </div>
</section>
